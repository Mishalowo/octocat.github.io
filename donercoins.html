<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Донеркоины | Донер-Хаус</title>
    <link rel="stylesheet" type="text/css" href="css/Донер.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <!-- Шапка -->
    <div class="header-container">
        <header class="header-grid">
            <div class="up-header">
                <nav class="nav-links">
                    <a class="nav-link" href="jobs.html">Работа у нас</a>
                    <a class="nav-link" href="about.html">О нас</a>
                    <a class="nav-link" href="contacts.html">Контакты</a>
                    <a class="nav-link" href="certificates.html">Сертификаты</a>
                </nav>
            </div>
        </header>
        
        <header class="header-grid">
            <div class="center-header">
                <div class="logo-container">
                    <a href="index.html"><img src="4627023.png" alt="Донер-Хаус"></a>
                    <p class="logo-text">Донер-Хаус</p>
                </div>
                <nav class="nav-links">
                    <a class="nav-link active" href="donercoins.html">Донеркоины</a>
                    <a class="nav-link" href="#" id="auth-link">Вход</a>
                </nav>
            </div>
        </header>
        
        <header class="header-grid">
            <div class="down-header">
                <div class="nav-links">
                    <a class="nav-link" href="index.html">Донеры</a>
                    <a class="nav-link" href="index.html">Комбо</a>
                    <a class="nav-link" href="index.html">Закуски</a>
                    <a class="nav-link" href="index.html">Напитки</a>
                    <a class="nav-link" href="index.html">Десерты</a>
                    <a class="nav-link" href="index.html">Соусы</a>
                    
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#">Ещё</a>
                        <div class="dropdown-content">
                            <a class="dropdown-link" href="index.html">Детское меню</a>
                            <a class="dropdown-link" href="index.html">Любимое</a>
                        </div>
                    </div>
                    
                    <!-- Корзина в правом углу -->
                    <div class="cart-button-container">
                        <a class="nav-link cart-button" href="#" id="cart-button">Корзина</a>
                        <div class="cart-badge empty" id="cart-badge">
                            <span class="cart-count">0</span>
                            <span class="cart-total-sum">0 ₽</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </div>

    <!-- Контент страницы -->
    <div class="page-content">
        <h1><i class="fas fa-coins"></i> Программа лояльности "Донеркоины"</h1>
        
        <div class="donercoins-hero">
            <div class="coins-display" id="user-coins-display">
                <i class="fas fa-coins"></i>
                <span id="coins-count">0</span>
            </div>
            <p style="font-size: 20px; color: #7C3603;">Накопительная система для наших постоянных клиентов</p>
            <p id="login-prompt" style="margin-top: 20px;">
                <a href="#" id="auth-link-page" class="cta-button">
                    <i class="fas fa-sign-in-alt"></i> Войдите, чтобы увидеть ваши коины
                </a>
            </p>
        </div>
        
        <h2><i class="fas fa-gift"></i> Как это работает?</h2>
        <div class="how-it-works">
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>Регистрируйтесь</h4>
                    <p>Создайте аккаунт на сайте</p>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <h4>Совершайте заказы</h4>
                    <p>Делайте заказы онлайн или в кафе</p>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <h4>Получайте коины</h4>
                    <p>1 рубль = 1 донеркоин</p>
                </div>
                
                <div class="step">
                    <div class="step-number">4</div>
                    <h4>Тратьте с умом</h4>
                    <p>Обменивайте на бонусы</p>
                </div>
            </div>
        </div>
        
        <h2><i class="fas fa-star"></i> Ваши преимущества</h2>
        <div class="coins-info-grid">
            <div class="coins-card">
                <h3><i class="fas fa-percentage"></i> Скидки</h3>
                <ul>
                    <li><strong>100 коинов</strong> = скидка 10% на следующий заказ</li>
                    <li><strong>250 коинов</strong> = скидка 15% на любой донер</li>
                    <li><strong>500 коинов</strong> = скидка 20% на заказ от 1000₽</li>
                </ul>
            </div>
            
            <div class="coins-card">
                <h3><i class="fas fa-gift"></i> Бонусы</h3>
                <ul>
                    <li><strong>750 коинов</strong> = бесплатный напиток</li>
                    <li><strong>1000 коинов</strong> = бесплатный донер</li>
                    <li><strong>2000 коинов</strong> = праздничный набор</li>
                </ul>
            </div>
            
            <div class="coins-card">
                <h3><i class="fas fa-crown"></i> Привилегии</h3>
                <ul>
                    <li>Персональные предложения</li>
                    <li>Приоритетная доставка</li>
                    <li>Участие в закрытых акциях</li>
                    <li>День рождения = двойные коины</li>
                </ul>
            </div>
        </div>
        
        <div class="section-bg">
            <h3><i class="fas fa-question-circle"></i> Частые вопросы</h3>
            
            <div class="info-card" style="margin-bottom: 20px;">
                <h4>Как накопить донеркоины быстрее?</h4>
                <p>Участвуйте в акциях, заказывайте в день рождения (получаете двойные коины), приглашайте друзей (получаете 100 коинов за каждого).</p>
            </div>
            
            <div class="info-card" style="margin-bottom: 20px;">
                <h4>Сгорают ли донеркоины?</h4>
                <p>Нет, донеркоины не сгорают. Однако мы рекомендуем тратить их в течение года после начисления.</p>
            </div>
            
            <div class="info-card">
                <h4>Можно ли передать коины другому человеку?</h4>
                <p>К сожалению, нет. Донеркоины привязаны к вашему аккаунту и не подлежат передаче.</p>
            </div>
        </div>
        
        <h2><i class="fas fa-chart-line"></i> История начислений</h2>
        <div id="coins-history" style="background: #f9f9f9; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
            <p style="text-align: center; color: #666; font-style: italic;" id="no-history-message">
                У вас еще нет истории начислений. Совершите первый заказ!
            </p>
            <table id="history-table" style="width: 100%; display: none;">
                <thead>
                    <tr style="background: #e9e9e9;">
                        <th style="padding: 10px; text-align: left;">Дата</th>
                        <th style="padding: 10px; text-align: left;">Описание</th>
                        <th style="padding: 10px; text-align: left;">Коины</th>
                    </tr>
                </thead>
                <tbody id="history-body">
                    <!-- История будет загружена через JS -->
                </tbody>
            </table>
        </div>
        
        <div style="text-align: center; margin: 40px 0;">
            <a href="index.html" class="cta-button">
                <i class="fas fa-shopping-cart"></i> Начать копить коины!
            </a>
        </div>
    </div>

    <!-- Футер -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Меню</h3>
                <ul>
                    <li><a href="index.html">Главная</a></li>
                    <li><a href="index.html">Донеры</a></li>
                    <li><a href="index.html">Комбо</a></li>
                    <li><a href="index.html">Закуски</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Программа лояльности</h3>
                <ul>
                    <li><a href="donercoins.html">Донеркоины</a></li>
                    <li><a href="#" id="auth-footer-page">Мои коины</a></li>
                    <li><a href="index.html">Как получить?</a></li>
                    <li><a href="contacts.html">Помощь</a></li>
                </ul>
            </div>
            
            <div class="footer-contact">
                <p><i class="fas fa-coins"></i> Коины не сгорают!</p>
                <p class="email">Накапливайте и тратьте с умом</p>
                <div class="footer-logo">
                    <img src="4627023.png" alt="Донер-Хаус">
                    <span>Донер-Хаус</span>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="social-networks">
                <span>Подпишитесь на акции:</span>
                <a href="#" class="social-icon">
                    <i class="fab fa-vk"></i>
                </a>
                <a href="#" class="social-icon">
                    <i class="fab fa-telegram"></i>
                </a>
                <a href="#" class="social-icon">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
        </div>
    </footer>

    <script>
    $(document).ready(function() {
        // Проверяем авторизацию
        const user = JSON.parse(localStorage.getItem('user'));
        
        if (user) {
            // Показываем коины пользователя
            const coins = user.donercoins || 0;
            $('#coins-count').text(coins);
            $('#login-prompt').hide();
            
            // Загружаем историю
            loadCoinsHistory(user);
        } else {
            // Прячем информацию о коинах
            $('#user-coins-display').hide();
            $('#coins-history').hide();
            
            // Обработчик кнопки входа
            $('#auth-link-page, #auth-footer-page').on('click', function(e) {
                e.preventDefault();
                // Вызываем функцию из main.js
                if (typeof showAuthModal === 'function') {
                    showAuthModal();
                } else {
                    alert('Для просмотра донеркоинов необходимо авторизоваться');
                }
            });
        }
        
        // Обработчик для кнопки входа в футере
        $('#auth-footer-page').on('click', function(e) {
            e.preventDefault();
            if (typeof showAuthModal === 'function') {
                showAuthModal();
            } else {
                alert('Для просмотра донеркоинов необходимо авторизоваться');
            }
        });
        
        function loadCoinsHistory(user) {
            // Загружаем заказы пользователя
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const userOrders = orders.filter(order => {
                // Проверяем email или userId
                if (order.email && user.email) {
                    return order.email === user.email;
                }
                return false;
            });
            
            if (userOrders.length > 0) {
                $('#no-history-message').hide();
                $('#history-table').show();
                
                // Сортируем по дате (новые сверху)
                userOrders.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                userOrders.forEach(order => {
                    const date = new Date(order.date).toLocaleDateString('ru-RU');
                    const coins = Math.floor(order.total);
                    
                    $('#history-body').append(`
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 10px;">${date}</td>
                            <td style="padding: 10px;">Заказ #${order.id}</td>
                            <td style="padding: 10px; color: #A64600; font-weight: bold;">+${coins}</td>
                        </tr>
                    `);
                });
            } else {
                $('#no-history-message').show();
            }
        }
    });
    </script>
</body>
</html>